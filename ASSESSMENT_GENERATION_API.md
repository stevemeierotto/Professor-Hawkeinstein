# Assessment Generation System - API Documentation

## Overview

The Assessment Generation System automatically creates unit tests, midterm exams, and final exams based on existing course lesson content. Assessments are intelligently generated by extracting learning objectives, key concepts, vocabulary, and practice problems from lessons.

**Key Features:**
- **Content-Based Generation**: Questions derived from actual lesson objectives and concepts
- **Multiple Question Types**: Multiple choice, true/false, short answer, problem-solving
- **Flexible Configuration**: Customizable difficulty, question counts, and coverage
- **Answer Keys**: Complete answer keys with explanations
- **Lesson Traceability**: Each question linked to specific unit and lesson

---

## API Endpoint

**URL:** `POST /api/admin/generate_assessment.php`

**Authentication:** Requires admin JWT token

**Timeout:** 5 minutes (300 seconds)

---

## Assessment Types

### 1. Unit Test

Tests a single unit's content.

**When to use:** After completing each unit, to assess student mastery of that unit's material.

**Default settings:**
- Questions: 20
- Coverage: All lessons in specified unit
- Typical time: 30-45 minutes for students

### 2. Midterm Exam

Tests cumulative content from multiple units (typically Units 1-3).

**When to use:** Halfway through course, after Unit 3.

**Default settings:**
- Questions: 40
- Coverage: Units 1-3
- Typical time: 60-90 minutes for students

### 3. Final Exam

Tests cumulative content from all units.

**When to use:** End of course, after completing all units.

**Default settings:**
- Questions: 60
- Coverage: All units in course
- Typical time: 90-120 minutes for students

---

## Request Parameters

### Required

- **`courseId`** (string): Course identifier
  - Example: `"algebra_1"`, `"biology_101"`
  
- **`assessmentType`** (string): Type of assessment
  - Values: `"unit_test"`, `"midterm"`, `"final_exam"`

### Type-Specific Required

For `unit_test`:
- **`unitNumber`** (integer): Which unit to test (1, 2, 3, etc.)

### Optional

- **`upToUnit`** (integer): For midterm/final, test units 1 through this number
  - Midterm default: 3
  - Final exam default: all units

- **`numQuestions`** (integer): Total number of questions
  - Unit test default: 20
  - Midterm default: 40
  - Final exam default: 60

- **`questionTypes`** (array): Question types to include
  - Default: `["multiple_choice", "short_answer", "problem_solving", "true_false"]`
  - Can specify subset: `["multiple_choice", "problem_solving"]`

- **`difficulty`** (string): Question difficulty
  - Values: `"easy"`, `"medium"`, `"hard"`, `"mixed"`
  - Default: `"mixed"`
  - Mixed creates balanced distribution across difficulty levels

- **`includeAnswerKey`** (boolean): Include answer key in response
  - Default: `true`

---

## Example Requests

### Generate Unit Test

```bash
curl -X POST "http://localhost/basic_educational/api/admin/generate_assessment.php" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "courseId": "algebra_1",
    "assessmentType": "unit_test",
    "unitNumber": 2,
    "numQuestions": 15,
    "difficulty": "mixed"
  }'
```

### Generate Midterm

```bash
curl -X POST "http://localhost/basic_educational/api/admin/generate_assessment.php" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "courseId": "algebra_1",
    "assessmentType": "midterm",
    "upToUnit": 3,
    "numQuestions": 40,
    "questionTypes": ["multiple_choice", "short_answer", "problem_solving"]
  }'
```

### Generate Final Exam

```bash
curl -X POST "http://localhost/basic_educational/api/admin/generate_assessment.php" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "courseId": "algebra_1",
    "assessmentType": "final_exam",
    "numQuestions": 60,
    "difficulty": "mixed",
    "includeAnswerKey": true
  }'
```

---

## Response Format

```json
{
  "success": true,
  "assessmentType": "unit_test",
  "unitNumber": 2,
  "courseId": "algebra_1",
  "courseName": "Algebra I - High School",
  "totalQuestions": 20,
  "assessment": {
    "title": "Unit 2 Test: Linear Equations",
    "instructions": "Answer all questions. Show your work for problem-solving questions.",
    "totalPoints": 100,
    "estimatedTime": "45 minutes",
    "questions": [
      {
        "questionNumber": 1,
        "type": "multiple_choice",
        "question": "What is the slope-intercept form of a linear equation?",
        "options": [
          "A) y = mx + b",
          "B) ax + by = c",
          "C) y - y1 = m(x - x1)",
          "D) x = my + b"
        ],
        "points": 2,
        "difficulty": "easy",
        "objective": "Identify and write equations in slope-intercept form",
        "unit": 2,
        "lesson": 1
      },
      {
        "questionNumber": 2,
        "type": "problem_solving",
        "question": "Solve for x: 3x + 7 = 22",
        "points": 5,
        "difficulty": "medium",
        "objective": "Solve one-step and multi-step linear equations",
        "unit": 2,
        "lesson": 3
      },
      {
        "questionNumber": 3,
        "type": "short_answer",
        "question": "Explain what the slope of a line represents in real-world terms.",
        "points": 3,
        "difficulty": "medium",
        "objective": "Interpret the meaning of slope in context",
        "unit": 2,
        "lesson": 2
      },
      {
        "questionNumber": 4,
        "type": "true_false",
        "question": "The y-intercept is the point where the line crosses the x-axis.",
        "points": 2,
        "difficulty": "easy",
        "objective": "Identify key features of linear equations",
        "unit": 2,
        "lesson": 1
      }
    ]
  },
  "answerKey": {
    "1": {
      "answer": "A",
      "explanation": "Slope-intercept form is y = mx + b, where m is the slope and b is the y-intercept."
    },
    "2": {
      "answer": "x = 5",
      "explanation": "Subtract 7 from both sides: 3x = 15. Divide by 3: x = 5.",
      "steps": [
        "3x + 7 = 22",
        "3x = 22 - 7",
        "3x = 15",
        "x = 5"
      ]
    },
    "3": {
      "answer": "The slope represents the rate of change, or how much y changes for each unit change in x.",
      "keyPoints": [
        "Rate of change",
        "Rise over run",
        "Unit change relationship"
      ]
    },
    "4": {
      "answer": "False",
      "explanation": "The y-intercept is where the line crosses the y-axis, not the x-axis."
    }
  },
  "lessonsCovered": [
    {
      "unit": 2,
      "lesson": 1,
      "title": "Slope-Intercept Form"
    },
    {
      "unit": 2,
      "lesson": 2,
      "title": "Graphing Linear Equations"
    },
    {
      "unit": 2,
      "lesson": 3,
      "title": "Solving Linear Equations"
    }
  ],
  "generationTime": 45.8
}
```

---

## Helper Functions

For easier integration, use the helper functions in `assessment_helpers.php`:

### PHP Usage

```php
require_once 'api/admin/assessment_helpers.php';

// Generate unit test
$result = generateUnitTest('algebra_1', 2, 20, 'mixed');

if ($result['success']) {
    echo "Generated {$result['totalQuestions']} questions\n";
    echo "Title: {$result['assessment']['title']}\n";
    
    // Save to course metadata
    $saved = saveAssessmentToCourse(
        'algebra_1',
        $result['assessment'],
        'unit_test',
        2
    );
}

// Generate midterm (after Unit 3)
$midterm = generateMidterm('algebra_1', 3, 40, 'mixed');

// Generate final exam (after Unit 6)
$final = generateFinalExam('algebra_1', null, 60, 'mixed');

// Generate ALL assessments for a course
$allAssessments = generateAllAssessments('algebra_1', true);
```

### Function Reference

#### `generateUnitTest($courseId, $unitNumber, $numQuestions, $difficulty, $questionTypes, $includeAnswerKey)`

Generates a test for a single unit.

**Parameters:**
- `$courseId` (string, required): Course identifier
- `$unitNumber` (int, required): Unit to test
- `$numQuestions` (int, default: 20): Number of questions
- `$difficulty` (string, default: 'mixed'): Difficulty level
- `$questionTypes` (array, default: all types): Question types
- `$includeAnswerKey` (bool, default: true): Include answers

**Returns:** Array with assessment data or error

---

#### `generateMidterm($courseId, $upToUnit, $numQuestions, $difficulty, $questionTypes, $includeAnswerKey)`

Generates a midterm exam covering Units 1-3 (or specified range).

**Parameters:**
- `$courseId` (string, required): Course identifier
- `$upToUnit` (int, default: 3): Test units 1 through this number
- `$numQuestions` (int, default: 40): Number of questions
- `$difficulty` (string, default: 'mixed'): Difficulty level
- `$questionTypes` (array, default: all types): Question types
- `$includeAnswerKey` (bool, default: true): Include answers

**Returns:** Array with assessment data or error

---

#### `generateFinalExam($courseId, $upToUnit, $numQuestions, $difficulty, $questionTypes, $includeAnswerKey)`

Generates a final exam covering all units (or up to specified unit).

**Parameters:**
- `$courseId` (string, required): Course identifier
- `$upToUnit` (int, default: null/all): Test units 1 through this number
- `$numQuestions` (int, default: 60): Number of questions
- `$difficulty` (string, default: 'mixed'): Difficulty level
- `$questionTypes` (array, default: all types): Question types
- `$includeAnswerKey` (bool, default: true): Include answers

**Returns:** Array with assessment data or error

---

#### `saveAssessmentToCourse($courseId, $assessment, $assessmentType, $unitNumber)`

Saves a generated assessment to course metadata file.

**Parameters:**
- `$courseId` (string, required): Course identifier
- `$assessment` (array, required): Assessment data from generator
- `$assessmentType` (string, required): "unit_test", "midterm", or "final_exam"
- `$unitNumber` (int, optional): Unit number for unit tests

**Returns:** Array with success status

---

#### `generateAllAssessments($courseId, $saveToMetadata)`

Generates all assessments for a complete course (unit tests for each unit, midterm, final).

**Parameters:**
- `$courseId` (string, required): Course identifier
- `$saveToMetadata` (bool, default: true): Save to course file

**Returns:** Array with results for all assessments

---

## Question Types

### Multiple Choice

- 4 options (A, B, C, D)
- One correct answer
- Plausible distractors
- Tests recognition and understanding

**Example:**
```json
{
  "questionNumber": 5,
  "type": "multiple_choice",
  "question": "Which of the following is equivalent to 3(x + 4)?",
  "options": [
    "A) 3x + 4",
    "B) 3x + 12",
    "C) x + 12",
    "D) 3x + 7"
  ],
  "points": 2,
  "difficulty": "medium"
}
```

---

### True/False

- Simple true or false statement
- Tests factual knowledge
- Clear, unambiguous statements

**Example:**
```json
{
  "questionNumber": 8,
  "type": "true_false",
  "question": "Parallel lines have the same slope.",
  "points": 2,
  "difficulty": "easy"
}
```

---

### Short Answer

- 1-3 sentence response
- Tests conceptual understanding
- Requires explanation, not just facts

**Example:**
```json
{
  "questionNumber": 12,
  "type": "short_answer",
  "question": "Describe the steps you would use to solve the equation 2x - 5 = 11.",
  "points": 4,
  "difficulty": "medium"
}
```

---

### Problem Solving

- Multi-step mathematical problem
- Requires calculation and work
- Shows complete solution process

**Example:**
```json
{
  "questionNumber": 15,
  "type": "problem_solving",
  "question": "A car rental company charges $35 per day plus $0.15 per mile. Write an equation for the total cost C for renting a car for d days and driving m miles. Then find the cost for renting a car for 3 days and driving 250 miles.",
  "points": 8,
  "difficulty": "hard"
}
```

---

## Content Extraction

The assessment generator automatically extracts content from lessons:

### Learning Objectives

Each lesson's objectives are analyzed and used to create targeted questions.

```
Lesson Objective → Assessment Question
"Solve multi-step equations" → Problem-solving question with 3-step equation
"Identify slope from graphs" → Multiple choice or visual question
```

### Vocabulary Terms

Key terms are used for:
- Definition matching questions
- True/false statements
- Multiple choice vocabulary questions

### Practice Problems

Existing practice problems inform:
- Similar problem-solving questions
- Difficulty calibration
- Solution approaches

---

## Workflow Integration

### Typical Course Development Flow

```
1. Generate Course Outline
   ↓
2. Generate Full Course Content
   ↓
3. Review and Refine Lessons
   ↓
4. Generate Unit Tests (after each unit)
   ├── Unit 1 Test
   ├── Unit 2 Test
   ├── Unit 3 Test → Generate Midterm
   ├── Unit 4 Test
   ├── Unit 5 Test
   └── Unit 6 Test → Generate Final Exam
   ↓
5. Review Assessments
   ↓
6. Save to Course Metadata
   ↓
7. Deploy Course
```

### Automated Assessment Generation

```php
// After generating full course content
require_once 'api/admin/assessment_helpers.php';

// Generate all assessments automatically
$results = generateAllAssessments('algebra_1', true);

if ($results['success']) {
    echo "Generated {$results['totalGenerated']} assessments\n";
    
    foreach ($results['assessments'] as $type => $result) {
        if ($result['success']) {
            echo "✓ $type: {$result['totalQuestions']} questions\n";
        } else {
            echo "✗ $type: {$result['error']}\n";
        }
    }
}
```

---

## Best Practices

### Before Generation

1. **Complete lesson generation first** - Assessments need lesson content
2. **Review lesson objectives** - Ensure objectives are clear and comprehensive
3. **Check vocabulary coverage** - Verify key terms are defined in lessons
4. **Validate practice problems** - Ensure examples are high quality

### During Generation

1. **Start with unit tests** - Generate and review unit tests before cumulative exams
2. **Adjust difficulty** - Use "easy" for struggling students, "hard" for advanced
3. **Customize question types** - Remove types that don't fit your course
4. **Set appropriate counts** - More questions = longer exam time

### After Generation

1. **Review questions** - Check alignment with objectives
2. **Verify answer keys** - Ensure answers are correct and explanations clear
3. **Check coverage** - Confirm all units/lessons adequately represented
4. **Test difficulty** - Ensure questions are appropriate for student level
5. **Save to metadata** - Store in course file for future use

---

## Error Handling

### Common Errors

**"Course file not found"**
```json
{
  "success": false,
  "error": "Course file not found: course_algebra_1.json"
}
```
Solution: Verify courseId is correct

**"No generated lessons found"**
```json
{
  "success": false,
  "error": "No generated lessons found to create assessment from. Generate lesson content first."
}
```
Solution: Generate course content before assessments

**"Unit X not found in course"**
```json
{
  "success": false,
  "error": "Unit 5 not found in course"
}
```
Solution: Check unit number matches course structure

**"Agent call failed"**
```json
{
  "success": false,
  "error": "Agent service error: Connection refused"
}
```
Solution: Ensure agent service is running on localhost:8080

---

## Performance

### Generation Times

- **Unit Test (20 questions):** 1-2 minutes
- **Midterm (40 questions):** 2-3 minutes  
- **Final Exam (60 questions):** 3-5 minutes
- **All Assessments (6 units):** 15-20 minutes

### Resource Usage

- **Memory:** ~500MB for assessment generation
- **CPU:** Delegated to agent service
- **Timeout:** 5 minutes per assessment

---

## Troubleshooting

### Debug Commands

```bash
# Check agent service
curl http://localhost:8080/health

# View logs
tail -f /tmp/agent_service_full.log

# Test assessment generation
bash tests/test_assessment_generator.sh
```

### Common Issues

**Low quality questions:**
- Review lesson objectives (ensure they're specific)
- Add more vocabulary terms to lessons
- Include more diverse practice problems

**Answer key incomplete:**
- Check validation warnings in logs
- Regenerate with longer timeout
- Manually review and complete

**Poor coverage:**
- Increase number of questions
- Ensure all lessons have content (not "outline" status)
- Adjust question distribution

---

## Related Documentation

- **FULL_COURSE_GENERATOR_MODE_API.md** - Course content generation
- **COMPLETE_COURSE_PIPELINE.md** - End-to-end workflow
- **assessment_helpers.php** - Helper function source code

---

## Version History

- **v1.0** (2024-11-28): Initial implementation with unit tests, midterm, and final exam generation

---

**Status:** ✅ Complete and ready for testing

**Author:** GitHub Copilot (Claude Sonnet 4.5)
